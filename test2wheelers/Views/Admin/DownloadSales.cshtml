@model _2whealers.Models.TransactionViewModel
@{
    ViewBag.Title = "Delivery Challan";
    Layout = "~/Views/Shared/_Admin_Layout.cshtml";
}


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

<div class="container-fluid px-3">
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card shadow-sm border-0 rounded-3">
                <div class="card-body">
                    <div class="col-md-12">
                        <div class="card shadow-sm border-0 rounded-3">
                            <div class="card-body">
                                <h4 class="fw-bold mb-4 text-primary">
                                    <i class="bi bi-funnel me-2"></i> Download Sales Transactions
                                </h4>

                                <form id="filterForm" method="post" action="/Admin/DownloadSales" class="row g-3 align-items-end">
                                    @Html.AntiForgeryToken()
                                    <div class="col-md-4">
                                        <label class="form-label fw-semibold">Date Range</label>
                                        <input type="text" id="dateRange" name="dateRange" class="form-control shadow-sm"
                                               placeholder="dd-mm-yyyy to dd-mm-yyyy" readonly />
                                    </div>
                                    <div class="col-md-2">
                                        <button id="searchBtn" type="button" class="btn btn-gradient w-100 shadow-sm">
                                            <i class="bi bi-search me-1"></i> Search
                                        </button>
                                    </div>
                                </form>


                                <!-- loader overlay -->
                                <div class="loading-overlay" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;
                                                 background:rgba(255,255,255,0.7);z-index:9999;text-align:center;padding-top:20%;">
                                    <div class="spinner-border text-primary" role="status"></div>
                                    <p class="mt-2 fw-bold">Loading...</p>
                                </div>

                                <script>
                                    function showLoader() {
                                        document.querySelector(".loading-overlay").style.display = "block";
                                    }
                                </script>

                            </div>




                            <div class="table-responsive">
                                <table id="PreSalesTable" class="table table-striped table-hover table-bordered align-middle shadow-sm rounded overflow-hidden">

                                    <thead style="background: linear-gradient(90deg, #6c63ff, #4facfe); color: #fff;">
                                        <tr>
                                            <th style="width:60px;" class="text-center">SNo.</th>
                                            <th>Name</th>
                                            <th>Mobile Number</th>
                                            <th>Model Name</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>

                            </div>
                            <style>
                                /* Gradient button */
                                .btn-gradient {
                                    background: linear-gradient(45deg, #6c63ff, #4facfe);
                                    color: #fff;
                                    border: none;
                                }

                                    .btn-gradient:hover {
                                        background: linear-gradient(45deg, #4facfe, #6c63ff);
                                        color: #fff;
                                    }

                                /* Table striping */
                                .table-striped tbody tr:nth-of-type(odd) {
                                    background-color: #f9f9ff;
                                }

                                /* Hover effect */
                                .table-hover tbody tr:hover {
                                    background-color: #eef2ff;
                                    transition: 0.3s;
                                }
                            </style>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script>

        $(function () {
            $('#dateRange').daterangepicker({
                autoUpdateInput: false,
                locale: {
                    format: 'DD-MM-YYYY',
                    cancelLabel: 'Clear'
                }
            });

            $('#dateRange').on('apply.daterangepicker', function (ev, picker) {
                $(this).val(picker.startDate.format('DD-MM-YYYY') + ' to ' + picker.endDate.format('DD-MM-YYYY'));
            });

            $('#dateRange').on('cancel.daterangepicker', function (ev, picker) {
                $(this).val('');
            });

                  $('#searchBtn').on('click', function () {
            var dateRange = $("#dateRange").val();

            if (!dateRange || dateRange.trim() === "") {
                toastr.error("⚠️ Please select a date range!", "Validation Error");
                return;
            }

            showLoader();

            $.ajax({
                url: '/Admin/DownloadSalesData',
                type: 'POST',
                data: {
                    dateRange: dateRange,
                    __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val()
                },
                success: function (res) {
                    $(".loading-overlay").hide();

                    if (res.success) {
                        var table = $('#PreSalesTable').DataTable();
                        table.clear();

                        $.each(res.data, function (i, item) {
                            table.row.add([
                                i + 1,
                                item.name,
                                item.mobileNo,
                                item.modelName,
                                item.cashAmount,
                                "Active"
                            ]);
                        });

                        table.draw();
                    } else {
                        toastr.error(res.message || "No data found");
                    }
                },
                error: function () {
                    $(".loading-overlay").hide();
                    toastr.error("Something went wrong while fetching data.");
                }
            });
        });

        });

              $(document).ready(function () {
            $('#PreSalesTable').DataTable({
                language: {
                    emptyTable: "No Models found"
                },
                dom: 'Bfrtip',   
                buttons: [
                    'copyHtml5',
                    'excelHtml5',
                    'csvHtml5',
                    'pdfHtml5',
                    'print'
                ]
            });
        });

    </script>
}
